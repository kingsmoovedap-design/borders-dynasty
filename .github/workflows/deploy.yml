# .github/workflows/deploy.yml
name: CodexChain Deploy

on:
  release:
    types: [created]
  workflow_dispatch:

jobs:
  verify-contract:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - name: Verify contract on Etherscan
        run: npx hardhat verify --network mainnet ${{ secrets.CONTRACT_ADDRESS }} ${{ secrets.CONSTRUCTOR_ARGS }}
        env:
          ETHERSCAN_API_KEY: ${{ secrets.ETHERSCAN_API_KEY }}

  notify-webhooks:
    needs: verify-contract
    runs-on: ubuntu-latest
    steps:
      - name: Notify Render Webhook
        run: curl -X POST ${{ secrets.RENDER_WEBHOOK_URL }}
      - name: Notify Alchemy Webhook
        run: curl -X POST ${{ secrets.ALCHEMY_WEBHOOK_URL }}

  deploy-frontend:
    needs: verify-contract
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist

  provenance:
    needs: deploy-frontend
    permissions:
      actions: read
      id-token: write
      contents: write
    uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.4.0
    with:
      base64-subjects: "TODO: insert digests or artifact hash here"
      upload-assets: true
