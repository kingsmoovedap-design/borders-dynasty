# Borders Dynasty - Web3 DeFi Platform

## Overview
A Web3 DeFi sovereign blockchain platform for the CodexChain/Borders Dynasty ecosystem. Features an upgradeable ERC20 token (Borders Sovereign Coin/BSC) with advanced governance controls, token transfers, minting, blacklisting, and on-chain document verification.

## Live Deployment
- **Contract Address**: `0x12efC9a5D115AE7833c9a6D79f1B3BA18Cde817c` (Sepolia)
- **Implementation**: `0xa0aE7B3bf4BB6e47Eebf858e50A34A570E156582` (Verified on Etherscan)
- **Sovereign Wallet**: `0xE89fDED72D0D83De3421C6642FA035ebE197804f`

## Web3 DeFi Features
- **Wallet Connection**: MetaMask/Web3 wallet integration with auto network switching
- **Token Transfers**: Send BSC tokens to any address
- **Minting**: Admin minting with MINTER_ROLE permission
- **Blacklisting**: Security controls with GUARD_ROLE permission
- **Document Registry**: On-chain document hash verification
- **Network Detection**: Auto-prompts to switch to Sepolia network
- **Real-time Balance**: Live balance updates after transactions
- **Transaction Logging**: Activity feed with transaction status

## Project Structure
- `src/` - Frontend source files (index.js, index.html)
- `src/abis/` - Contract ABIs (auto-synced from compiled artifacts)
- `public/` - Static assets (manifest.json for PWA)
- `apps/api/` - Express logistics API with Codex integration
  - `src/routes/` - API route definitions
  - `src/controllers/` - Request handlers
  - `src/services/` - Business logic
  - `src/codex/` - Codex Ecclesia client
- `packages/codex-client/` - Reusable Codex client package
- `contracts/` - Solidity smart contracts (BordersSovereignCoin, DynasticIdentity, ScrollHashRegistry)
- `scripts/` - Deployment and utility scripts (including syncAbis.js)
- `artifacts/` - Compiled contract artifacts (generated by Hardhat)
- `test/` - Test files
- `dist/` - Built output (generated)
- `.openzeppelin/` - Proxy deployment manifests

## Logistics API Endpoints
- `GET /health` - Health check
- `GET /loads` - List all loads
- `POST /loads` - Create a new load (body: { origin, destination })
- `GET /loads/:id` - Get load by ID
- `POST /loads/:id/delivered` - Mark load as delivered

## Environment Variables
- `CODEX_URL` - URL of Codex Ecclesia service (default: http://localhost:3001)
- `API_PORT` - Port for Logistics API (default: 3000)

## Monorepo Services
The project runs two services:
- **Logistics API** (port 3000) - FreightEngine-powered load management
- **Codex Ecclesia** (port 3001) - Hash-chain record keeping with anchoring

Start both with: `node server.cjs`

## Codex Ecclesia Endpoints
- `GET /health` - Health check
- `POST /codex/records` - Create a hash-chained record
- `GET /codex/records` - List all records
- `POST /codex/anchors` - Create merkle root anchor
- `GET /codex/anchors` - List all anchors

## Smart Contracts
- **BordersSovereignCoin.sol**: Upgradeable ERC20 with MINTER_ROLE, GUARD_ROLE, blacklist, pausable, 1M cap
- **DynasticIdentity.sol**: Soulbound NFT for royal titles and sovereign recognition
- **ScrollHashRegistry.sol**: On-chain document verification via keccak256 hashes

## Development
- Run `npm run dev` to start the webpack dev server on port 5000
- Run `npm run build` to create production bundle in `dist/`
- Run `npm run compile` to compile Solidity contracts
- Run `npm run sync:abis` to sync compiled ABIs to src/abis/
- Run `npm run compile:sync` to compile and sync ABIs in one command
- Run `npx hardhat run scripts/deploy-upgradeable.js --network sepolia` to deploy contracts

## Key Configuration
- Webpack bundles the app with babel transpilation
- Dev server configured on port 5000 with hot reloading and WebSocket fix
- Hardhat configured for Ethereum development (Sepolia network)
- OpenZeppelin Upgrades plugin for transparent proxy pattern

## Cross-Repository Integration
- **Codex Ecclesia**: Synchronized via ECCLESIA_INTEGRATION_URL and DYNASTY_SHARED_SECRET
- **Nation Sovereign ID**: DYNASTY-BORDERS-001
- **Public Notice URL**: https://codex-ecclesia-public.onrender.com/api/notices

## Compliance
- QFS-Compatible Architecture (v1.0)
- ISO-20022 Ready
- Full Etherscan verification

## Deployment
Static deployment configured - builds with webpack and serves from `dist/` directory.
Render.yaml configured for automated deployment with environment secrets.
