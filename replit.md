# Borders Dynasty - Web3 DeFi Platform

## Overview
A Web3 DeFi sovereign blockchain platform for the CodexChain/Borders Dynasty ecosystem. Features an upgradeable ERC20 token (Borders Sovereign Coin/BSC) with advanced governance controls, token transfers, minting, blacklisting, and on-chain document verification.

## Live Deployment
- **Contract Address**: `0x12efC9a5D115AE7833c9a6D79f1B3BA18Cde817c` (Sepolia)
- **Implementation**: `0xa0aE7B3bf4BB6e47Eebf858e50A34A570E156582` (Verified on Etherscan)
- **Sovereign Wallet**: `0xE89fDED72D0D83De3421C6642FA035ebE197804f`

## Web3 DeFi Features
- **Wallet Connection**: MetaMask/Web3 wallet integration with auto network switching
- **Token Transfers**: Send BSC tokens to any address
- **Minting**: Admin minting with MINTER_ROLE permission
- **Blacklisting**: Security controls with GUARD_ROLE permission
- **Document Registry**: On-chain document hash verification
- **Network Detection**: Auto-prompts to switch to Sepolia network
- **Real-time Balance**: Live balance updates after transactions
- **Transaction Logging**: Activity feed with transaction status

## Project Structure
- `src/` - Frontend source files (index.js, index.html)
- `src/abis/` - Contract ABIs (auto-synced from compiled artifacts)
- `public/` - Static assets (manifest.json for PWA)
- `apps/api/` - Express logistics API with Codex integration
  - `src/routes/` - API route definitions
  - `src/controllers/` - Request handlers
  - `src/services/` - Business logic
  - `src/codex/` - Codex Ecclesia client
- `packages/codex/` - Codex Ecclesia service and client
- `packages/freight-logic/` - FreightEngine with mode validation
- `packages/ops-config/` - Global ops readiness and activation flags
- `packages/treasury/` - TreasuryEngine for BSC token escrow and payouts
- `packages/devine-credit/` - DevineCredit system for driver credit lines
- `packages/ecclesia-client/` - Client for Codex Ecclesia public API
- `contracts/` - Solidity smart contracts (BordersSovereignCoin, DynasticIdentity, ScrollHashRegistry)
- `scripts/` - Deployment and utility scripts (including syncAbis.js)
- `artifacts/` - Compiled contract artifacts (generated by Hardhat)
- `test/` - Test files
- `dist/` - Built output (generated)
- `.openzeppelin/` - Proxy deployment manifests

## Global Ops Configuration
Modes: GROUND, AIR, OCEAN, COURIER
Regions: NORTH_AMERICA, EUROPE, ASIA_PACIFIC, LATAM

### Ops API Endpoints
- `GET /ops/status` - View mode/region readiness and activation status
- `POST /ops/activate-mode` - Activate a mode (body: { mode })
- `POST /ops/deactivate-mode` - Deactivate a mode (body: { mode })
- `POST /ops/activate-region` - Activate a region (body: { region }) - only if ready
- `POST /ops/global-launch` - Activate all modes + NORTH_AMERICA/EUROPE at once
- `POST /ops/staged-launch` - Execute staged launch (body: { stage: LOCAL|NATIONWIDE|GLOBAL })
- `GET /ops/launch-plan/:stage` - Get launch plan for a stage
- `POST /ops/set-region-ready` - Mark a region as ready (body: { region })

## Treasury API Endpoints
- `GET /treasury/balance` - Get escrow balance and payout count
- `GET /treasury/payouts` - List all payouts issued

## DevineCredit API Endpoints
- `POST /drivers` - Register driver with credit line (body: { driverId, name, homeBase, equipment })
- `GET /drivers/:id` - Get driver info and credit line
- `GET /drivers/:id/credit` - Get driver credit status
- `POST /drivers/:id/advance` - Issue credit advance (body: { amount, loadId })
- `GET /credit/lines` - List all credit lines
- `GET /credit/transactions` - List all credit transactions

## Logistics API Endpoints
- `GET /health` - Health check with supported modes
- `GET /loads` - List all loads
- `POST /loads` - Create load (body: { shipperId, origin, destination, mode, budgetAmount, region })
- `GET /loads/:id` - Get load by ID
- `POST /loads/:id/in-transit` - Mark load in transit
- `POST /loads/:id/delivered` - Mark load as delivered

## Environment Variables
- `CODEX_URL` - URL of Codex Ecclesia service (default: http://localhost:3001)
- `API_PORT` - Port for Logistics API (default: 3000)

## Monorepo Services
The project runs two services:
- **Logistics API** (port 3000) - FreightEngine-powered load management
- **Codex Ecclesia** (port 3001) - Hash-chain record keeping with anchoring

Start both with: `node server.cjs`

## Codex Ecclesia Endpoints
- `GET /health` - Health check
- `POST /codex/records` - Create a hash-chained record
- `GET /codex/records` - List all records
- `POST /codex/anchors` - Create merkle root anchor
- `GET /codex/anchors` - List all anchors

## Smart Contracts
- **BordersSovereignCoin.sol**: Upgradeable ERC20 with MINTER_ROLE, GUARD_ROLE, blacklist, pausable, 1M cap
- **DynasticIdentity.sol**: Soulbound NFT for royal titles and sovereign recognition
- **ScrollHashRegistry.sol**: On-chain document verification via keccak256 hashes

## Development
- Run `npm run dev` to start the webpack dev server on port 5000
- Run `npm run build` to create production bundle in `dist/`
- Run `npm run compile` to compile Solidity contracts
- Run `npm run sync:abis` to sync compiled ABIs to src/abis/
- Run `npm run compile:sync` to compile and sync ABIs in one command
- Run `npx hardhat run scripts/deploy-upgradeable.js --network sepolia` to deploy contracts

## Key Configuration
- Webpack bundles the app with babel transpilation
- Dev server configured on port 5000 with hot reloading and WebSocket fix
- Hardhat configured for Ethereum development (Sepolia network)
- OpenZeppelin Upgrades plugin for transparent proxy pattern

## Cross-Repository Integration
- **Codex Ecclesia**: Synchronized via ECCLESIA_INTEGRATION_URL and DYNASTY_SHARED_SECRET
- **Nation Sovereign ID**: DYNASTY-BORDERS-001
- **Public Notice URL**: https://codex-ecclesia-public.onrender.com/api/notices

## Compliance
- QFS-Compatible Architecture (v1.0)
- ISO-20022 Ready
- Full Etherscan verification

## Deployment
Static deployment configured - builds with webpack and serves from `dist/` directory.
Render.yaml configured for automated deployment with environment secrets.
